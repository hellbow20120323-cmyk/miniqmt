# 159201 策略数据对比：当前策略 vs 重构前策略

同一数据区间、同一脚本，仅参数与逻辑不同。回测数据来源：`history_159201_1m.csv`（1 分钟 K 线）。

---

## 一、参数与逻辑差异概览

| 项目 | 重构前（旧版） | 当前策略（新版） |
|------|----------------|------------------|
| 佣金 | 万二 (0.02%) | **万一 (0.01%)** |
| 步长下限 | 0.08% | **0.12%**（覆盖约 1 tick 滑点） |
| ATR 网格系数 | 0.28 | **0.38**（网格更疏） |
| 强制止损线 | 2.5 万 | **1.5 万**（针对 20 万流动仓） |
| 层数加成步长 | 无 | **有**：步长 = 基础 + 层数×0.01% |
| 全平冷静期 | 关闭 | **开启**：全平后 15 根 K 线内不新开第一层 |
| 趋势斜率 | 原始 diff(5) | **3 周期 EMA 平滑** |
| 止盈阈值 | 固定（×涨多系数） | **层数自适应**：1–3 层×1.0，4–6 层×0.9，7–9 层×0.7 |

---

## 二、回测结果对比

| 指标 | 重构前（旧版） | 当前策略（新版） | 变化 |
|------|----------------|------------------|------|
| **成交总数（买+卖）** | 477 | 324 | −153（约 −32%） |
| **打满 9 层次数** | 23 | 11 | −12 |
| **打满且完成平仓轮次** | 13 | 7 | −6 |
| **其中亏损轮次** | 0 | 0 | 持平 |
| **Alpha 套利净收益（元）** | 44,172 | 31,491 | −12,681（约 −29%） |
| **流动仓年化（自然日）** | 22.96% | 16.37% | −6.59% |
| **流动仓年化（资金占用日）** | 34.45% | 31.23% | −3.22% |
| **Beta 持仓市值变动（元）** | 92,216 | 92,216 | 持平 |
| **策略摊薄总收益（元）** | 136,388 | 123,706 | −12,682 |
| **Alpha 曲线最大回撤** | −457.78% | −494.99% | 略加深 |
| **有仓天数** | 234 | 184 | −50 |
| **打满后想买但无子弹的 K 线数** | 28,983 | 982 | 大幅减少 |
| **ATR 熔断未加仓 K 线数** | 32 | 19 | −13 |

---

## 三、简要解读

- **当前策略**：步长更大、层数加成、冷静期、层数自适应止盈，**交易更少、开仓更保守**，所以成交笔数、打满次数、完成平仓轮次都减少，Alpha 与总收益在本次回测中低于旧版。
- **旧版策略**：步长更密、无冷静期、止盈不随层数调整，**触发更频繁**，在同样数据上 Alpha 和总收益更高，但打满后“想买但无子弹”的 K 线很多（28,983），资金利用率与风险暴露更大。
- **Beta**：两版固定仓 30 万一致，Beta 收益相同。
- **亏损轮次**：两版均为 0，说明在本段数据上均未出现“打满且完成平仓”的亏损轮。

若更看重**控制回撤、减少频繁交易、实盘滑点与成本**，当前策略更偏保守、稳健；若更看重**历史区间内 Alpha 与总收益最大化**，旧版在本段回测中数值更高。

---

*数据来自同目录下 `mac_backtest_159201.py` 在相同数据文件上的两次运行（仅切换参数与逻辑）。*

---

## 四、前密后疏 ATR 因子（0–3 层 0.32 / 4–9 层 0.38）vs 统一 0.38

| 项目 | 统一 ATR 系数 0.38 | 前密后疏（0–3 层 0.32，4–9 层 0.38） |
|------|---------------------|----------------------------------------|
| 成交总数 | 324 | 324 |
| 打满 9 层次数 | 11 | 11 |
| 打满且完成平仓轮次 | 7 | 7 |
| Alpha 套利净收益（元） | 31,491 | 31,491 |
| 策略摊薄总收益（元） | 123,706 | 123,706 |
| ATR 熔断未加仓 K 线数 | 19 | 22 |

**结论**：在本段回测中两者结果一致。可能原因：步长下限 **GRID_STEP_FLOOR = 0.12%** 在前几层经常生效（即 `(ATR/价)×0.32` 或 `×0.38` 仍小于 0.12%），实际步长被下限锁死，前密后疏的系数差未体现。在 ATR 更大的区间或调低步长下限后，前密后疏有望在 0–3 层增加小幅震荡时的成交频次。
