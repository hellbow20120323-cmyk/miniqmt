# 159201 自由现金流 ETF 网格套利策略文档

> 版本：趋势自适应 + 仓位分级  
> 更新日期：2025-02-11

---

## 一、策略概述

本策略针对 **159201（自由现金流 ETF）** 设计，采用 **T+0 日内网格套利** 模式：在价格下跌时分档买入，在整体盈利达到阈值时一次性清仓，赚取 Alpha 收益。策略核心为 **ATR 动态网格 + 趋势自适应 + 仓位分级**，实现「涨多卖、跌少买」的顺势逻辑。

---

## 二、资金与仓位

| 参数 | 值 | 说明 |
|------|-----|------|
| 初始资金 | 40 万 | 总可用资金 |
| 单笔套利金额 | 10 万 | 单次套利最大投入（占 25%） |
| 最大补仓层数 | 5 层 | 每层约 2 万，分批买入 |
| 最小交易单位 | 100 股 | 按 100 股整数倍下单 |

---

## 三、核心逻辑

### 3.1 买入条件

- **触发**：当前价 ≤ 上次买入价 × (1 - 网格步长)
- **限制**：最多补仓 5 层，每层金额由趋势动态调整
- **网格步长**：`max(0.3%, ATR14/价格 × 0.7)`，再按趋势系数调整

### 3.2 卖出条件

- **触发**：T+0 持仓整体盈利 ≥ 止盈阈值
- **方式**：一次性清仓全部 T+0 仓位
- **止盈阈值**：基准 0.6%，按趋势系数动态调整

### 3.3 趋势判断

- **指标**：MA60 的 5 周期变化率  
  `ma60_slope = (ma60 - ma60.shift(5)) / ma60.shift(5)`
- **上升趋势**：slope > 0
- **下降趋势**：slope < 0
- **中性**：slope = 0

---

## 四、参数配置

### 4.1 网格参数

| 参数 | 值 | 说明 |
|------|-----|------|
| ATR_PERIOD | 14 | ATR 计算周期 |
| ATR_GRID_FACTOR | 0.7 | 网格步长 = ATR/价格 × 0.7 |
| GRID_STEP_FLOOR | 0.003 | 步长下限 0.3% |

### 4.2 止盈参数

| 参数 | 值 | 说明 |
|------|-----|------|
| SELL_PROFIT_THRESHOLD | 0.006 | 基准止盈 0.6% |

### 4.3 趋势自适应参数

| 趋势 | 网格系数 | 止盈系数 | 仓位系数 | 效果 |
|------|----------|----------|----------|------|
| 上升 | 1.2 | 1.33 | 0.7 | 跌少买、涨多卖 |
| 下降 | 0.85 | 0.83 | 1.2 | 跌多买、涨少卖 |
| 中性 | 1.0 | 1.0 | 1.0 | 基准 |

**上升趋势时**：
- 网格放宽 1.2 倍 → 需更大跌幅才触发补仓
- 止盈提高至约 0.8%（0.6% × 1.33）
- 每档买入缩小至 70% → 跌少买

**下降趋势时**：
- 网格收紧 0.85 倍 → 更易触发补仓
- 止盈降低至约 0.5%（0.6% × 0.83）
- 每档买入放大至 120% → 跌多买

---

## 五、数据与执行

### 5.1 数据源

- **文件**：`history_159201_1m.csv`
- **周期**：1 分钟 K 线
- **字段**：open, high, low, close（需含 index 为时间戳）

### 5.2 回测脚本

```bash
python3 mac_backtest_159201.py
```

### 5.3 实盘对接

- Mac 端：`mac_dashboard.py` 读取 `shared_quote.json`，计算 BOLL/RSI/ATR/MA60 斜率
- 信号输出：`order_signal.json` 供 Windows 端 xtquant 执行
- 需在 dashboard 中实现与本策略一致的买入/卖出逻辑

---

## 六、回测表现（参考）

| 指标 | 数值 |
|------|------|
| 成交笔数 | 22 |
| Alpha 套利净值 | 约 2,714 元 |
| Beta 市值变动 | 约 121,912 元 |
| 综合摊薄贡献 | 约 124,627 元 |

*注：结果依赖历史数据区间，实盘表现可能不同。*

---

## 七、风险与注意事项

1. **T+0 限制**：仅对 T+0 可交易标的有效，需确认 159201 支持当日卖出
2. **滑点与手续费**：回测未扣除手续费，实盘需预留成本
3. **趋势误判**：MA60 斜率有滞后，震荡市可能频繁切换
4. **流动性**：ETF 流动性一般较好，但仍需关注大单冲击
5. **参数敏感性**：仓位系数、网格系数等需根据实盘表现微调

---

## 八、高频率预设（目标 100-200 笔/年以上）

通过微调 ATR 系数和止盈阈值，实现年化 100-200+ 笔成交：

| 参数 | 默认 | 高频率 |
|------|------|--------|
| ATR_GRID_FACTOR | 0.7 | **0.4** |
| GRID_STEP_FLOOR | 0.003 (0.3%) | **0.001 (0.1%)** |
| SELL_PROFIT_THRESHOLD | 0.6% | **0.4%** |
| UPTREND_GRID_FACTOR | 1.2 | **1.0** |
| DOWNTREND_GRID_FACTOR | 0.85 | **0.7** |

切换方式：在 `mac_backtest_159201.py` 中设置 `PRESET = "high_freq"` 或 `"default"`。

**高频率回测结果**（约 1 年数据）：415 笔成交，年化约 432 笔，Alpha 约 34,919 元。

**参数扫描**：`mac_backtest_159201_sweep.py` 批量测试；`mac_backtest_159201_quick.py` 快速验证。若需将笔数控制在 100-200，可尝试 ATR 0.35、FLOOR 0.001、DOWN 0.7、SELL 0.4% 等组合。

---

## 九、后续优化方向

- 分批止盈：阶梯式卖出（如 +0.5% 卖 1/3，+1.0% 卖 1/3）
- 波动率过滤：ATR 极端时暂停交易
- 成交量确认：买入时要求放量
- 趋势强度分级：强/中/弱趋势使用不同参数
