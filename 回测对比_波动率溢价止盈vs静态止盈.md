# 回测对比：波动率溢价止盈 (Volatility-Based TP) vs 静态止盈

同一数据 `history_159201_1m.csv`，同一脚本，仅 `VOL_TP_ENABLED` 不同。其余：LAYER_WEIGHTS 中段加重、1-3 层基准 0.45%、7-9 层 0.7× 均一致。

## 波动率溢价公式

- **基准**：`0.4% + (ATR14 / Price) × 0.1`，按 K 线动态计算，再按层 1-3 全量、4-6 层 ×0.9、7-9 层 ×0.7。
- **上限**：1.2%（`VOL_TP_CAP`），避免极端波动时阈值过高。
- **效果**：波动大时多拿一点利润，波动小时快速收割，提升单笔质量。

## 回测结果对比

| 指标 | 静态止盈 (VOL_TP=Off) | 波动率溢价止盈 (VOL_TP=On) |
|------|------------------------|----------------------------|
| **成交总数(买+卖)** | 80 | 108 |
| **打满(9层)次数** | 2 次 | 4 次 |
| **打满且完成平仓轮次** | 2 轮 | 2 轮 |
| **其中亏损轮次** | 0 轮 | 0 轮 |
| **Alpha 套利净收益** | 6,542.04 元 | 7,657.23 元 |
| **流动仓年化(自然日)** | 3.40% | 3.98% |
| **资金占用** | 11.94%（有仓 100 日） | 13.84%（有仓 101 日） |
| **止盈卖光次数** | 40 次 | 54 次 |

## 简要结论

- **波动率溢价止盈**在本段回测中：成交笔数增加约 **35%**（80→108），Alpha 增加约 **17%**（6,542→7,657），年化与资金占用略有提升。
- 低波动时阈值接近 0.4% 快速收割、高波动时阈值上浮多拿利润，在**笔数增加的同时总 Alpha 提升**，单笔平均收益与资金利用均优于静态止盈。
- 建议默认保持 **VOL_TP_ENABLED = True**；若需与历史版本严格对齐，可关闭恢复静态 0.45% / 0.9× / 0.7×。

*数据来源：mac_backtest_159201.py 在同一数据上的两次运行，仅 VOL_TP_ENABLED 不同。*
